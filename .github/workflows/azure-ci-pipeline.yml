name: Azure CI pipeline

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "*" ]

  workflow_dispatch:

jobs:

  azure_login:
    runs-on: ubuntu-24.04
    environment: engineering
    steps:
    - name: Azure Login
      id: azure_login
      uses: azure/login@v2
      env:
        AZURE_LOGIN_PRE_CLEANUP: true
        AZURE_LOGIN_POST_CLEANUP: true
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
        enable-AzPSSession: true

    - name: Azure CLI script
      id: azure_cli_script
      uses: azure/cli@v2
      with:
        azcliversion: latest
        inlineScript: |
          az account show
          az group list --output table

    - name: Set output variables
      id: set_outputs
      run: |
        echo "azcliversion=$(az version --output tsv --query \"azure-cli\")" >> $GITHUB_OUTPUT
        echo "account=$(az account show --query \"user.name\" -o tsv)" >> $GITHUB_OUTPUT
        echo "subscription=$(az account show --query \"name\" -o tsv)" >> $GITHUB_OUTPUT

    outputs:
      AZURE_CLI_VERSION: ${{ steps.azure_cli_script.outputs.azcliversion }}
      AZURE_CURRENT_ACCOUNT: ${{ steps.azure_cli_script.outputs.account }}
      AZURE_CURRENT_SUBSCRIPTION: ${{ steps.azure_cli_script.outputs.subscription }}
  
  debug:
    runs-on: ubuntu-24.04
    environment: engineering
    needs: azure_login
    steps:
    # steps to run custom scripts
    - name: Run a multi-line script
      run: |
        echo "::debug::Set the Octocat variable as an environment variable"
        echo ::notice title=Set the Octocat variable::export OCTOCAT="üêô"
        echo "::debug:: Value of GITHUB_API_URL is $GITHUB_API_URL"
        echo "::debug:: Value of GITHUB_GRAPHQL_URL is $GITHUB_GRAPHQL_URL"




      
